<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlÅŸimist</title>
    <meta name="theme-color" content="#ECEEF4">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="light-theme" data-mode="academy">
    <!-- Top Navbar (Sticky) -->
    <nav class="navbar">
        <div class="navbar-container">
            <!-- Left: Logo + Title -->
            <div class="navbar-left">
                <div class="navbar-logo-section">
                    <button id="mobileSidebarBtn" class="navbar-btn mobile-only" title="MenÃ¼">
                        <i class="fas fa-bars"></i>
                    </button>
                    <img src="icon.png" alt="Logo" class="navbar-logo">
                    <span class="navbar-title">AlÅŸimist</span>
                </div>
            </div>

            <!-- Center: Mode Toggle -->
            <div class="navbar-center">
                <div class="mode-toggle" role="tablist" aria-label="GÃ¶rÃ¼nÃ¼m modu">
                    <button class="mode-toggle-btn" data-mode="farmer" role="tab" aria-selected="false">
                        <i class="fas fa-tractor"></i>
                        <span data-i18n="mode.farmer">Son KullanÄ±cÄ± / Ã‡iftÃ§i</span>
                    </button>
                    <button class="mode-toggle-btn active" data-mode="academy" role="tab" aria-selected="true">
                        <i class="fas fa-graduation-cap"></i>
                        <span data-i18n="mode.academy">Ã–ÄŸrenci / Akademi</span>
                    </button>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="navbar-right">
                <button id="themeToggle" class="navbar-btn" title="Tema DeÄŸiÅŸtir">
                    <i class="fas fa-sun"></i>
                </button>
                <button id="readDeviceBtn" class="navbar-btn" title="Cihazdan Oku ve GÃ¶nder">
                    <i class="fab fa-bluetooth-b"></i>
                    <span class="navbar-btn-label">Verileri EÅŸitle</span>
                </button>
                <button id="settingsBtn" class="navbar-btn" title="Ayarlar">
                    <i class="fas fa-sliders-h"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar Panel -->
        <aside class="sidebar-panel">
            <div class="sidebar-header">
                <h3 data-i18n="sidebar.title">Kontrol Merkezi</h3>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="sidebar-mode-toggle">
                <div class="mode-toggle" role="tablist" aria-label="GÃ¶rÃ¼nÃ¼m modu">
                    <button class="mode-toggle-btn" data-mode="farmer" role="tab" aria-selected="false">
                        <i class="fas fa-tractor"></i>
                        <span data-i18n="mode.farmer">Son KullanÄ±cÄ± / Ã‡iftÃ§i</span>
                    </button>
                    <button class="mode-toggle-btn active" data-mode="academy" role="tab" aria-selected="true">
                        <i class="fas fa-graduation-cap"></i>
                        <span data-i18n="mode.academy">Ã–ÄŸrenci / Akademi</span>
                    </button>
                </div>
            </div>

            <nav class="sidebar-nav">
                <!-- Stats Section -->
                <div class="nav-section">
                    <div class="nav-title" data-i18n="sidebar.stats">Ä°statistikler</div>
                    <div class="nav-items">
                        <div class="stat-mini-card">
                            <span class="stat-mini-value" id="sensorCount">0</span>
                            <span class="stat-mini-label" data-i18n="sidebar.totalSensors">Toplam SensÃ¶r</span>
                        </div>
                        <div class="stat-mini-card">
                            <span class="stat-mini-value" id="avgTds">-</span>
                            <span class="stat-mini-label" data-i18n="sidebar.avgTds">Ortalama TDS (ppm)</span>
                        </div>
                    </div>
                </div>

                <!-- Filters Section -->
                <div class="nav-section">
                    <div class="nav-title" data-i18n="sidebar.riskLevels">Risk Seviyeleri</div>
                    <div class="nav-items">
                        <label class="nav-item">
                            <input type="checkbox" data-risk="low" checked>
                            <span class="filter-indicator low"></span>
                            <span data-i18n="sidebar.low">DÃ¼ÅŸÃ¼k</span>
                        </label>
                        <label class="nav-item">
                            <input type="checkbox" data-risk="medium" checked>
                            <span class="filter-indicator medium"></span>
                            <span data-i18n="sidebar.medium">Orta</span>
                        </label>
                        <label class="nav-item">
                            <input type="checkbox" data-risk="high" checked>
                            <span class="filter-indicator high"></span>
                            <span data-i18n="sidebar.high">YÃ¼ksek</span>
                        </label>
                    </div>
                </div>

                <!-- Sensors Section -->
                <div class="nav-section">
                    <div class="nav-title" data-i18n="sidebar.sensorSelect">SensÃ¶r SeÃ§imi</div>
                    <div class="nav-items">
                        <select id="sensorSelect" class="sensor-select">
                            <option value="" data-i18n="sidebar.viewAll">TÃ¼mÃ¼ GÃ¶rÃ¼ntÃ¼le</option>
                        </select>
                    </div>
                </div>

                <!-- Map Control -->
                <div class="nav-section">
                    <div class="nav-title" data-i18n="sidebar.map">Harita</div>
                    <div class="nav-items">
                        <button id="mapToggle" class="nav-btn">
                            <i class="fas fa-map"></i> <span data-i18n="sidebar.mapOpen">AÃ§</span>
                        </button>
                    </div>
                </div>

                <!-- Map Settings -->
                <div class="nav-section map-settings" style="display: none;">
                    <div class="nav-title" data-i18n="sidebar.mapType">Harita Tipi</div>
                    <div class="nav-items">
                        <label class="nav-item">
                            <input type="radio" name="mapType" value="normal" checked>
                            <span data-i18n="sidebar.mapNormal">Normal Harita</span>
                        </label>
                        <label class="nav-item">
                            <input type="radio" name="mapType" value="satellite">
                            <span data-i18n="sidebar.mapSatellite">Uydu GÃ¶rÃ¼ntÃ¼sÃ¼</span>
                        </label>
                        <label class="nav-item">
                            <input type="radio" name="mapType" value="nasa-water">
                            <span data-i18n="sidebar.mapNasa">NASA Su HaritasÄ±</span>
                        </label>
                        <label class="nav-item">
                            <input type="checkbox" id="sensorMarkersToggle" checked>
                            <span data-i18n="sidebar.showSensors">SensÃ¶rleri GÃ¶ster</span>
                        </label>
                    </div>
                </div>
            </nav>

            <div class="sidebar-footer">
                <small id="lastUpdate">--</small>
            </div>
        </aside>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content Area -->
        <main class="content-area">
            <!-- Dashboard Charts Section -->
            <section class="dashboard-section">
                <div class="dashboard-header">
                    <h2 id="dashboardTitle" data-i18n="dashboard.academyTitle">Akademi Paneli</h2>
                    <div class="time-filter" data-mode="academy">
                        <button class="time-btn active" data-range="1w" data-i18n="time.1w">1 Hafta</button>
                        <button class="time-btn" data-range="2w" data-i18n="time.2w">2 Hafta</button>
                    </div>
                    <div class="data-controls">
                        <span id="connectionStatus" class="data-status">Cihaz baÄŸlÄ± deÄŸil</span>
                        <span id="dataStatus" class="data-status">Veri bekleniyor</span>
                    </div>
                </div>

                <div class="live-values">
                    <div class="live-card">
                        <span class="live-label">TDS</span>
                        <span class="live-value" id="liveTds">-</span>
                    </div>
                    <div class="live-card">
                        <span class="live-label">Nem</span>
                        <span class="live-value" id="liveMoisture">-</span>
                    </div>
                    <div class="live-card">
                        <span class="live-label">SÄ±caklÄ±k</span>
                        <span class="live-value" id="liveTemp">-</span>
                    </div>
                    <div class="live-card">
                        <span class="live-label">Son Sync</span>
                        <span class="live-value" id="lastSyncValue">-</span>
                    </div>
                </div>

                <div class="mode-panels">
                    <!-- Farmer / End-User Mode -->
                    <div class="mode-panel" data-mode="farmer">
                        <div class="indicators">
                            <div class="indicator-card" id="obriskIndicator">
                                <div class="indicator-title" data-i18n="farmer.obrukTitle">Obruk Riski</div>
                                <div class="indicator-value">-</div>
                                <div class="indicator-meter">
                                    <span class="indicator-fill" data-meter="obrisk"></span>
                                </div>
                                <div class="indicator-desc" data-i18n="farmer.obrukDesc">Ã‡iftÃ§ilere yÃ¶nelik kÄ±sa aÃ§Ä±klama.</div>
                            </div>
                            <div class="indicator-card" id="salinityIndicator">
                                <div class="indicator-title" data-i18n="farmer.salinityTitle">Tuzlanma Durumu</div>
                                <div class="indicator-value">-</div>
                                <div class="indicator-meter">
                                    <span class="indicator-fill" data-meter="salinity"></span>
                                </div>
                                <div class="indicator-desc" data-i18n="farmer.salinityDesc">Toprak/gÃ¼ncel tuzlanma durumu.</div>
                            </div>
                        </div>

                        <div class="charts-grid farmer-grid">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="farmer.toleranceTitle">ðŸŒ¿ Bitkilerin Tuzluluk ToleransÄ±</h3>
                                    <span class="chart-meta" data-i18n="meta.summary">Ã–zet</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="cropToleranceChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="farmer.cropsTitle">ðŸª´ Ekilen ÃœrÃ¼nler: Tuzluluk & pH</h3>
                                    <span class="chart-meta" data-i18n="meta.top5">Top 5</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="cropPhChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="farmer.yieldTitle">ðŸ“‰ Verim DÃ¼ÅŸÃ¼ÅŸÃ¼ EÄŸilimi</h3>
                                    <span class="chart-meta" data-i18n="meta.8w">Son 8 hafta</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="yieldDropChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="farmer.moistureTitle">ðŸ’§ Toprak Nem GÃ¶stergesi</h3>
                                    <span class="chart-meta" data-i18n="meta.current">GÃ¼ncel</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="soilMoistureChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Academic Mode -->
                    <div class="mode-panel" data-mode="academy">
                        <div class="charts-grid">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="academy.tdsTitle">TDS Seviyesi (Zaman Serisi)</h3>
                                    <span class="chart-meta" data-i18n="meta.7d">Son 7 gÃ¼n</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="tdsChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="academy.riskTitle">Risk DaÄŸÄ±lÄ±mÄ±</h3>
                                    <span class="chart-meta" data-i18n="meta.current">GÃ¼ncel</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="riskChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="academy.compareTitle">SensÃ¶r KarÅŸÄ±laÅŸtÄ±rmasÄ±</h3>
                                    <span class="chart-meta" data-i18n="meta.top5">Top 5</span>
                                </div>
                                <div class="chart-container">
                                    <canvas id="comparisonChart"></canvas>
                                </div>
                            </div>

                            <div class="chart-card">
                                <div class="chart-header">
                                    <h3 data-i18n="academy.statsTitle">Ä°statistiksel Ã–zet</h3>
                                    <span class="chart-meta" data-i18n="meta.current">GÃ¼ncel</span>
                                </div>
                                <div class="stats-summary">
                                    <div class="summary-item">
                                        <span class="summary-label" data-i18n="stats.max">Maksimum TDS</span>
                                        <span class="summary-value" id="maxTds">-</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label" data-i18n="stats.min">Minimum TDS</span>
                                        <span class="summary-value" id="minTds">-</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label" data-i18n="stats.std">Std. Sapma</span>
                                        <span class="summary-value" id="stdTds">-</span>
                                    </div>
                                    <div class="summary-item">
                                        <span class="summary-label" data-i18n="stats.anomaly">Anomali OranÄ±</span>
                                        <span class="summary-value" id="anomalyRate">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Map Container (Hidden by default) -->
            <section class="map-section" style="display: none;">
                <div class="map-header">
                    <h2 data-i18n="map.title">Harita GÃ¶rÃ¼nÃ¼mÃ¼</h2>
                    <button id="setEspLocationBtn" class="nav-btn">
                        <i class="fas fa-location-crosshairs"></i>
                        <span>ESP Konumunu Sapta</span>
                    </button>
                    <button id="mapClose" class="btn-close" title="Kapat">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="map" class="map-container"></div>
            </section>
        </main>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="settings.title">Ayarlar</h3>
                <button class="modal-close" id="settingsClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-grid">
                    <div class="settings-card" data-settings="language">
                        <div class="settings-title" data-i18n="settings.language">Dil</div>
                        <div class="settings-control">
                            <button class="lang-btn active" data-lang="tr">TR</button>
                            <button class="lang-btn" data-lang="en">EN</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-title" data-i18n="settings.links">BaÄŸlantÄ±lar</div>
                        <div class="settings-control">
                            <a href="https://github.com/SyewaN/hydrosense-map" target="_blank" class="settings-link">
                                <i class="fab fa-github"></i>
                                <span data-i18n="settings.github">GitHub Reposu</span>
                            </a>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-title" data-i18n="settings.about">HakkÄ±nda</div>
                        <div class="settings-control">
                            <p data-i18n="settings.aboutText1">Projemiz farklÄ± bÃ¶lgelerdeki esp aygÄ±tlarÄ± ile aldÄ±klarÄ± veriler arasÄ±nda korelasyon tahmini yaparak obruk ve su tuzlanma riskini tahmin eder.</p>
                            <p data-i18n="settings.aboutText2">Proje kesinlik iddia etmez, deneyseldir.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- App scripts -->
    <script src="js/data-loader.js"></script>
    <script src="js/map-renderer.js"></script>
    <script src="js/ble-sync.js"></script>
    <script src="js/pwa.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
